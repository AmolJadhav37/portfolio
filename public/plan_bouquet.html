<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Bouquet: Interactive Database Query Optimization</title>
     <link rel="icon" type="image/png" href="my_logo.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 30px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .nav-btn.active {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            transform: scale(1.05);
        }
        
        .section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .section.active { display: block; }
        
        .concept-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #4ecdc4;
        }
        
        .formula {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin: 15px 0;
            border: 2px solid rgba(78, 205, 196, 0.3);
        }
        
        .visualization-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }
        
        .canvas-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: inset 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        canvas {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            background: linear-gradient(145deg, #2a2d3e, #1a1d2e);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .slider-container {
            margin: 15px 0;
        }
        
        .slider-container label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #4ecdc4;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            appearance: none;
            cursor: pointer;
        }
        
        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .value-display {
            color: #ffd93d;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }
        
        .log-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 150px;
            border: 1px solid rgba(78, 205, 196, 0.3);
        }
        
        .log-content {
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-box {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .comparison-box h4 {
            color: #4ecdc4;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .step {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            padding: 6px 12px;
            border-radius: 15px;
            display: inline-block;
            margin: 3px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .highlight {
            color: #ffd93d;
            font-weight: bold;
        }
        
        .success { color: #4ecdc4; }
        .error { color: #ff6b6b; }
        .warning { color: #ffd93d; }
        
        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-btn {
                width: 80%;
                text-align: center;
            }
        }
        
        .animated {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header animated">
            <h1>Plan Bouquet Algorithm</h1>
            <p>Robust Database Query Processing Without Selectivity Estimation</p>
        </div>
        
        <nav class="navigation">
            <button class="nav-btn active" onclick="showSection('problem')">The Problem</button>
            <button class="nav-btn" onclick="showSection('concepts')">Key Concepts</button>
            <button class="nav-btn" onclick="showSection('algorithm')">Algorithm</button>
            <button class="nav-btn" onclick="showSection('demo')">Interactive Demo</button>
            <button class="nav-btn" onclick="showSection('performance')">Performance</button>
        </nav>
        
        <!-- Problem Section -->
        <section id="problem" class="section active">
            <h2>The Core Problem: Selectivity Estimation Errors</h2>
            
            <div class="concept-box">
                <h3>What is Selectivity?</h3>
                <p>Selectivity measures what fraction of rows satisfy a query condition:</p>
                <div class="formula">
                    Selectivity = Matching Rows / Total Rows
                </div>
                <p><strong>Example:</strong> If a table has 1,000,000 rows and your WHERE clause matches 50,000 rows, selectivity = 0.05 (5%)</p>
            </div>
            
            <div class="comparison-grid">
                <div class="comparison-box">
                    <h4 class="error">Traditional Optimizer Problem</h4>
                    <p><span class="step">Step 1</span> Optimizer guesses: "This will process 1,000 rows"</p>
                    <p><span class="step">Step 2</span> Chooses Plan A (optimized for small datasets)</p>
                    <p><span class="step">Step 3</span> Reality: Query actually processes 100,000 rows!</p>
                    <p><span class="step error">Result</span> Plan A becomes 100x slower than optimal</p>
                </div>
                
                <div class="comparison-box">
                    <h4 class="success">Plan Bouquet Solution</h4>
                    <p><span class="step">Step 1</span> Prepare multiple plans for different scenarios</p>
                    <p><span class="step">Step 2</span> Try plans in order, switching when budget exceeded</p>
                    <p><span class="step">Step 3</span> Discover actual selectivity through execution</p>
                    <p><span class="step success">Result</span> Never more than 4x slower than optimal!</p>
                </div>
            </div>
            
            <div class="concept-box">
                <h3>Why Do Estimation Errors Occur?</h3>
                <ul style="line-height: 1.8; margin-left: 20px;">
                    <li><strong>Outdated Statistics:</strong> Data has changed since last analysis</li>
                    <li><strong>Independence Assumptions:</strong> Optimizer assumes unrelated predicates</li>
                    <li><strong>Complex Predicates:</strong> User-defined functions, regex patterns</li>
                    <li><strong>Join Complexity:</strong> Hard to predict cross-table relationships</li>
                </ul>
            </div>
        </section>
        
        <!-- Concepts Section -->
        <section id="concepts" class="section">
            <h2>Key Mathematical Concepts</h2>
            
            <div class="concept-box">
                <h3>1. Error-Prone Selectivity Space (ESS)</h3>
                <p>Think of this as a multi-dimensional space where each dimension represents one unreliable predicate in your query.</p>
                <div class="formula">
                    Point q(s‚ÇÅ, s‚ÇÇ, ..., s‚Çì) = A query with specific selectivities
                </div>
            </div>
            
            <div class="concept-box">
                <h3>2. Sub-optimality Ratio</h3>
                <p>Measures how much slower your chosen plan is compared to the optimal plan:</p>
                <div class="formula">
                    SubOpt = Chosen Plan Cost / Optimal Plan Cost
                </div>
                <p><strong>Examples:</strong> Ratio of 1 = perfect, Ratio of 10 = 10x slower than optimal</p>
            </div>
            
            <div class="concept-box">
                <h3>3. POSP and PIC</h3>
                <p><strong>POSP (Parametric Optimal Set of Plans):</strong> All the optimal plans across different selectivity scenarios</p>
                <p><strong>PIC (POSP Infimum Curve):</strong> The ideal performance line - best possible cost at each selectivity</p>
                <div class="formula">
                    PIC(s) = min{cost_of_plan_i(s) | plan_i ‚àà POSP}
                </div>
            </div>
            
            <div class="concept-box">
                <h3>4. Isocost Surfaces</h3>
                <p>Budget levels that double each time to ensure optimal competitive ratio:</p>
                <div class="formula">
                    IC‚ÇÅ = a, IC‚ÇÇ = 2a, IC‚ÇÉ = 4a, IC‚ÇÑ = 8a, ...
                </div>
                <p><strong>Why doubling?</strong> Mathematical proof shows this gives the best possible guarantee of ‚â§4x optimal cost.</p>
            </div>
        </section>
        
        <!-- Algorithm Section -->
        <section id="algorithm" class="section">
            <h2>The Bouquet Algorithm</h2>
            
            <div class="concept-box">
                <h3>Compile-Time Phase</h3>
                <div class="step">Step 1</div> <strong>Identify Error-Prone Dimensions:</strong> Find which predicates have unreliable estimates
                <br><br>
                <div class="step">Step 2</div> <strong>Generate POSP:</strong> Find optimal plans for different selectivity combinations
                <br><br>
                <div class="step">Step 3</div> <strong>Create Isocost Surfaces:</strong> Project budget levels onto the cost surface
                <br><br>
                <div class="step">Step 4</div> <strong>Select Bouquet Plans:</strong> Choose representative plans that intersect with budget levels
            </div>
            
            <div class="concept-box">
                <h3>Run-Time Algorithm</h3>
                <div class="formula">
                    for each budget_level k = 1 to max_levels:<br>
                    &nbsp;&nbsp;for each plan P in bouquet_plans[k]:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;execute P with current_budget<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;if P completes: return results<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;else: try next plan<br>
                    &nbsp;&nbsp;double the budget and continue
                </div>
            </div>
            
            <div class="concept-box">
                <h3>Key Performance Guarantees</h3>
                <ul style="line-height: 1.8; margin-left: 20px;">
                    <li><strong>1D Case:</strong> MSO ‚â§ 4 (never more than 4x slower than optimal)</li>
                    <li><strong>Multi-D Case:</strong> MSO ‚â§ 4 √ó œÅ (where œÅ = max plans on any budget level)</li>
                    <li><strong>Anorexic Reduction:</strong> Reduces œÅ dramatically with small accuracy trade-off</li>
                </ul>
            </div>
        </section>
        
        <!-- Demo Section -->
        <section id="demo" class="section">
            <h2>Interactive Demonstration</h2>
            
            <div class="controls">
                <div class="slider-container">
                    <label for="selectivity-slider">
                        Actual Query Selectivity: <span id="selectivity-value" class="value-display">5.0%</span>
                    </label>
                    <input type="range" id="selectivity-slider" class="slider" 
                           min="0.5" max="15" step="0.1" value="5.0">
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn" onclick="runAnimation()">Run Bouquet Algorithm</button>
                    <button class="btn" onclick="resetDemo()">Reset Demo</button>
                    <button class="btn" onclick="showComparison()">Show Traditional vs Bouquet</button>
                </div>
            </div>
            
            <div class="visualization-container">
                <h3>Plan Bouquet Execution Visualization</h3>
                <div class="canvas-container">
                    <canvas id="main-canvas" width="900" height="500"></canvas>
                </div>
                
                <div class="log-container">
                    <h4>Execution Log:</h4>
                    <div id="log-content" class="log-content">
                        Adjust the selectivity slider and click "Run Bouquet Algorithm" to see the magic happen!
                    </div>
                </div>
            </div>
            
            <div class="comparison-grid">
                <div class="comparison-box">
                    <h4>Legend</h4>
                    <p><span style="color: #4ecdc4;">‚ñ†</span> PIC (Optimal Performance Curve)</p>
                    <p><span style="color: #ffd93d;">---</span> Isocost Budget Lines</p>
                    <p><span style="color: #ff6b6b;">‚óè</span> Bouquet Plans</p>
                    <p><span style="color: #00ff00;">‚ñº</span> Actual Query Location</p>
                </div>
                
                <div class="comparison-box">
                    <h4>Algorithm Status</h4>
                    <div id="status-display">
                        <p>Ready to execute</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Performance Section -->
        <section id="performance" class="section">
            <h2>Performance Characteristics</h2>
            
            <div class="concept-box">
                <h3>Theoretical Guarantees</h3>
                <p>The Plan Bouquet approach provides the first <strong>mathematically proven</strong> performance bounds in database literature:</p>
                <ul style="line-height: 1.8; margin-left: 20px;">
                    <li><strong>Worst-case guarantee:</strong> Never more than 4x slower than optimal (1D case)</li>
                    <li><strong>Competitive ratio:</strong> Best possible for any deterministic online algorithm</li>
                    <li><strong>Repeatable execution:</strong> Same query always uses same strategy</li>
                </ul>
            </div>
            
            <div class="comparison-grid">
                <div class="comparison-box">
                    <h4 class="error">Traditional Optimizer Issues</h4>
                    <p>‚Ä¢ Can be 100x-1000x slower than optimal</p>
                    <p>‚Ä¢ Performance varies unpredictably</p>
                    <p>‚Ä¢ No guarantees or bounds</p>
                    <p>‚Ä¢ Depends on estimation accuracy</p>
                </div>
                
                <div class="comparison-box">
                    <h4 class="success">Plan Bouquet Benefits</h4>
                    <p>‚Ä¢ Mathematical guarantee: ‚â§4x slower</p>
                    <p>‚Ä¢ Consistent, predictable performance</p>
                    <p>‚Ä¢ Works without selectivity estimation</p>
                    <p>‚Ä¢ Learns actual selectivities during execution</p>
                </div>
            </div>
            
            <div class="concept-box">
                <h3>Real-World Results</h3>
                <p>Experimental results on TPC-H and TPC-DS benchmarks:</p>
                <ul style="line-height: 1.8; margin-left: 20px;">
                    <li><strong>TPC-DS Query 19 (5D):</strong> MSO reduced from 10‚Å∂ to just 10</li>
                    <li><strong>Average improvement:</strong> Orders of magnitude better worst-case</li>
                    <li><strong>Average-case:</strong> Comparable or better than traditional optimizer</li>
                    <li><strong>Bouquet size:</strong> Typically ‚â§10 plans even for complex 5D queries</li>
                </ul>
            </div>
        </section>
    </div>
    
    <script>
        // Global variables
        let currentSection = 'problem';
        let currentSelectivity = 5.0;
        let animationRunning = false;
        let canvas, ctx;
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeCanvas();
            updateSelectivityValue();
            drawStaticVisualization();
            
            // Add slider event listener
            document.getElementById('selectivity-slider').addEventListener('input', function() {
                currentSelectivity = parseFloat(this.value);
                updateSelectivityValue();
                if (!animationRunning) {
                    drawStaticVisualization();
                }
            });
        });
        
        function showSection(sectionName) {
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            document.getElementById(sectionName).classList.add('animated');
            
            currentSection = sectionName;
            
            // Initialize canvas if demo section
            if (sectionName === 'demo') {
                setTimeout(() => {
                    initializeCanvas();
                    drawStaticVisualization();
                }, 100);
            }
        }
        
        function initializeCanvas() {
            canvas = document.getElementById('main-canvas');
            if (!canvas) return;
            ctx = canvas.getContext('2d');
        }
        
        function updateSelectivityValue() {
            const slider = document.getElementById('selectivity-slider');
            const display = document.getElementById('selectivity-value');
            if (slider && display) {
                currentSelectivity = parseFloat(slider.value);
                display.textContent = currentSelectivity.toFixed(1) + '%';
            }
        }
        
        function drawStaticVisualization() {
            if (!canvas || !ctx) return;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Set up dimensions
            const margin = 80;
            const chartWidth = canvas.width - 2 * margin;
            const chartHeight = canvas.height - 2 * margin;
            const maxSelectivity = 15;
            const maxCost = 800;
            
            // Draw axes
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(margin, margin);
            ctx.lineTo(margin, canvas.height - margin);
            ctx.lineTo(canvas.width - margin, canvas.height - margin);
            ctx.stroke();
            
            // Draw axis labels
            ctx.fillStyle = 'white';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Selectivity (%)', canvas.width / 2, canvas.height - 20);
            
            ctx.save();
            ctx.translate(25, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Query Cost (units)', 0, 0);
            ctx.restore();
            
            // Draw selectivity scale
            ctx.font = '11px Arial';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.textAlign = 'center';
            for (let i = 0; i <= maxSelectivity; i += 3) {
                const x = margin + (i / maxSelectivity) * chartWidth;
                ctx.fillText(i + '%', x, canvas.height - 45);
                
                // Draw grid lines
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(x, margin);
                ctx.lineTo(x, canvas.height - margin);
                ctx.stroke();
            }
            
            // Draw cost scale
            ctx.textAlign = 'right';
            for (let cost = 0; cost <= maxCost; cost += 100) {
                const y = canvas.height - margin - (cost / maxCost) * chartHeight;
                ctx.fillText(cost, margin - 10, y + 4);
                
                // Draw grid lines
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(margin, y);
                ctx.lineTo(canvas.width - margin, y);
                ctx.stroke();
            }
            
            // Draw PIC curve (POSP Infimum Curve)
            ctx.strokeStyle = '#4ecdc4';
            ctx.lineWidth = 4;
            ctx.beginPath();
            
            for (let x = margin; x < canvas.width - margin; x += 2) {
                const selectivity = ((x - margin) / chartWidth) * maxSelectivity;
                const cost = calculatePICCost(selectivity);
                const y = canvas.height - margin - (cost / maxCost) * chartHeight;
                
                if (x === margin) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // Label PIC curve
            ctx.fillStyle = '#4ecdc4';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('PIC (Optimal Performance)', margin + 50, margin + 30);
            
            // Draw isocost lines
            const baseCost = 100;
            ctx.strokeStyle = '#ffd93d';
            ctx.lineWidth = 3;
            ctx.setLineDash([8, 6]);
            
            const costs = [baseCost, baseCost*2, baseCost*4, baseCost*8];
            costs.forEach((cost, i) => {
                const y = canvas.height - margin - (cost / maxCost) * chartHeight;
                if (y > margin) {
                    ctx.beginPath();
                    ctx.moveTo(margin, y);
                    ctx.lineTo(canvas.width - margin, y);
                    ctx.stroke();
                    
                    // Label isocost lines
                    ctx.fillStyle = '#ffd93d';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`IC${i+1} (${cost} units)`, margin + 20, y - 8);
                }
            });
            ctx.setLineDash([]);
            
            // Draw bouquet plans
            ctx.fillStyle = '#ff6b6b';
            const planData = [
                {selectivity: 2, cost: baseCost, name: 'P1'},
                {selectivity: 4, cost: baseCost*2, name: 'P2'},
                {selectivity: 7, cost: baseCost*4, name: 'P3'},
                {selectivity: 12, cost: baseCost*8, name: 'P4'}
            ];
            
            planData.forEach(plan => {
                const x = margin + (plan.selectivity / maxSelectivity) * chartWidth;
                const y = canvas.height - margin - (plan.cost / maxCost) * chartHeight;
                
                if (y > margin) {
                    // Draw plan point
                    ctx.beginPath();
                    ctx.arc(x, y, 10, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    // Label plan
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(plan.name, x, y + 35);
                    ctx.fillStyle = '#ff6b6b';
                }
            });
            
            // Draw actual query location
            const actualX = margin + (currentSelectivity / maxSelectivity) * chartWidth;
            const actualCost = calculatePICCost(currentSelectivity);
            const actualY = canvas.height - margin - (actualCost / maxCost) * chartHeight;
            
            // Draw arrow pointing to actual location
            ctx.fillStyle = '#00ff00';
            ctx.beginPath();
            ctx.moveTo(actualX, margin + 20);
            ctx.lineTo(actualX - 15, margin + 45);
            ctx.lineTo(actualX + 15, margin + 45);
            ctx.closePath();
            ctx.fill();
            
            // Label actual location
            ctx.fillStyle = '#00ff00';
            ctx.font = 'bold 13px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`Actual: ${currentSelectivity.toFixed(1)}%`, actualX, margin + 10);
            
            // Draw traditional optimizer estimate (always wrong)
            const estimatedX = margin + (1 / maxSelectivity) * chartWidth;
            ctx.fillStyle = '#ff4444';
            ctx.beginPath();
            ctx.arc(estimatedX, margin + 80, 8, 0, 2 * Math.PI);
            ctx.fill();
            ctx.font = 'bold 11px Arial';
            ctx.fillText('Traditional Est: 1%', estimatedX, margin + 100);
        }
        
        function calculatePICCost(selectivity) {
            // Realistic cost function that increases with selectivity
            return 50 + Math.pow(selectivity + 0.5, 1.8) * 45;
        }
        
        function runAnimation() {
            if (animationRunning) return;
            
            animationRunning = true;
            const logContent = document.getElementById('log-content');
            const statusDisplay = document.getElementById('status-display');
            
            // Clear previous logs
            logContent.innerHTML = '';
            statusDisplay.innerHTML = '<p class="warning">Executing Plan Bouquet Algorithm...</p>';
            
            // Plan data for the current selectivity
            const planData = [
                {selectivity: 2, cost: 100, name: 'P1', description: 'Nested Loop Join - optimal for low selectivity'},
                {selectivity: 4, cost: 200, name: 'P2', description: 'Hash Join - medium selectivity'},
                {selectivity: 7, cost: 400, name: 'P3', description: 'Sort-Merge Join - higher selectivity'},
                {selectivity: 12, cost: 800, name: 'P4', description: 'Full scan approach - high selectivity'}
            ];
            
            let currentPlan = 0;
            let totalCost = 0;
            let stepCount = 0;
            
            function executeNextStep() {
                stepCount++;
                
                if (currentPlan >= planData.length || currentSelectivity <= planData[currentPlan].selectivity) {
                    // Success case
                    const plan = planData[Math.min(currentPlan, planData.length - 1)];
                    totalCost += plan.cost;
                    const optimalCost = calculatePICCost(currentSelectivity);
                    const ratio = (totalCost / optimalCost).toFixed(1);
                    
                    logContent.innerHTML += `
                        <p class="success">‚úÖ SUCCESS! ${plan.name} completed within budget!</p>
                        <p><strong>üìä Final Results:</strong></p>
                        <p>‚Ä¢ Target selectivity: ${currentSelectivity.toFixed(1)}%</p>
                        <p>‚Ä¢ Total execution cost: ${totalCost} units</p>
                        <p>‚Ä¢ Optimal cost: ${Math.round(optimalCost)} units</p>
                        <p>‚Ä¢ Performance ratio: <span class="highlight">${ratio}x</span> (‚â§4x guaranteed!)</p>
                        <p>‚Ä¢ Steps taken: ${stepCount}</p>
                    `;
                    
                    statusDisplay.innerHTML = `
                        <p class="success">Algorithm completed successfully!</p>
                        <p>Performance: ${ratio}x optimal</p>
                    `;
                    
                    animationRunning = false;
                    return;
                }
                
                // Plan execution attempt
                const plan = planData[currentPlan];
                totalCost += plan.cost;
                
                logContent.innerHTML += `
                    <p><span class="step">Step ${stepCount}</span> Trying ${plan.name} (${plan.description})</p>
                    <p>Budget: ${plan.cost} units | Target: ${currentSelectivity.toFixed(1)}% selectivity</p>
                `;
                
                // Simulate execution time
                setTimeout(() => {
                    logContent.innerHTML += `<p class="error">‚ùå BUDGET EXCEEDED! Actual selectivity (${currentSelectivity.toFixed(1)}%) > Plan capacity (${plan.selectivity}%)</p><br>`;
                    
                    currentPlan++;
                    
                    if (currentPlan < planData.length) {
                        logContent.innerHTML += `<p class="warning">‚è≠Ô∏è Switching to next plan with doubled budget...</p>`;
                        setTimeout(executeNextStep, 1200);
                    } else {
                        executeNextStep(); // This will trigger success
                    }
                }, 1000);
            }
            
            // Start animation
            logContent.innerHTML = `
                <p><strong>üöÄ Starting Plan Bouquet Algorithm</strong></p>
                <p>Query selectivity: ${currentSelectivity.toFixed(1)}%</p>
                <p>Traditional optimizer estimated: 1% (wrong!)</p>
                <hr style="border-color: rgba(255,255,255,0.3); margin: 10px 0;">
            `;
            
            setTimeout(executeNextStep, 1000);
        }
        
        function resetDemo() {
            animationRunning = false;
            const logContent = document.getElementById('log-content');
            const statusDisplay = document.getElementById('status-display');
            
            logContent.innerHTML = 'Adjust the selectivity slider and click "Run Bouquet Algorithm" to see the algorithm in action!';
            statusDisplay.innerHTML = '<p>Ready to execute</p>';
            
            drawStaticVisualization();
        }
        
        function showComparison() {
            const logContent = document.getElementById('log-content');
            const optimalCost = calculatePICCost(currentSelectivity);
            const traditionalCost = calculatePICCost(currentSelectivity) * 50; // Assume traditional is 50x worse
            const bouquetCost = optimalCost * Math.min(4, 1 + currentSelectivity * 0.1); // Realistic bouquet cost
            
            logContent.innerHTML = `
                <h4 style="color: #4ecdc4;">üìä Performance Comparison</h4>
                <p><strong>Query Selectivity:</strong> ${currentSelectivity.toFixed(1)}%</p>
                <hr style="border-color: rgba(255,255,255,0.3); margin: 10px 0;">
                
                <p><span class="success">üéØ Optimal Performance:</span> ${Math.round(optimalCost)} units</p>
                
                <p><span class="error">‚ùå Traditional Optimizer:</span></p>
                <p>  ‚Ä¢ Estimated selectivity: 1% (wrong!)</p>
                <p>  ‚Ä¢ Chose Plan P1 (nested loop)</p>
                <p>  ‚Ä¢ Actual cost: ${Math.round(traditionalCost)} units</p>
                <p>  ‚Ä¢ Performance ratio: <span class="error">${(traditionalCost/optimalCost).toFixed(1)}x slower</span></p>
                
                <p><span class="success">‚úÖ Plan Bouquet:</span></p>
                <p>  ‚Ä¢ No initial estimation needed</p>
                <p>  ‚Ä¢ Discovers actual selectivity during execution</p>
                <p>  ‚Ä¢ Total cost: ${Math.round(bouquetCost)} units</p>
                <p>  ‚Ä¢ Performance ratio: <span class="success">${(bouquetCost/optimalCost).toFixed(1)}x slower</span></p>
                <p>  ‚Ä¢ <strong>Guaranteed: ‚â§4x optimal</strong></p>
                
                <hr style="border-color: rgba(255,255,255,0.3); margin: 10px 0;">
                <p class="highlight">Plan Bouquet is ${(traditionalCost/bouquetCost).toFixed(0)}x better than traditional optimizer!</p>
            `;
        }
    </script>
</body>
</html>